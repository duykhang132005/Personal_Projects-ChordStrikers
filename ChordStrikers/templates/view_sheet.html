{% extends "index.html" %}

{% block title %}{{ song.title }} | ChordStrikers{% endblock %}

{% block content %}
<div class="container py-5 text-white">
  <h1 class="mb-3">{{ song.title }}</h1>
  <p class="mb-1"><strong>Artist:</strong> {{ song.artist }}</p>
  <p class="mb-4"><strong>Key:</strong> {{ song.song_key or '—' }}</p>

  <div class="mb-3">
    <a href="{{ url_for('creator.edit_song', song_id=song.id) }}" class="btn btn-primary">Edit</a>
    <a href="{{ url_for('main.explore') }}" class="btn btn-danger">Return</a>
  </div>
  
<div class="d-flex align-items-center flex-wrap gap-2 mb-4 unified-controls">
  <!-- Transpose controls -->
  <div id="transpose-controls" class="d-flex align-items-center gap-2">
    <!-- transpose down -->
    <div class = "control-box">
    <button type="button" class="transpose-btn control-btn" aria-label="Transpose down one semitone" data-step="-1">←</button>

    <input id="steps" type="text" inputmode="numeric" pattern="^-?\d{1,2}$"
           value="0" class="steps-input" aria-label="Semitone steps (−11 to +11)">

    <!-- transpose up -->
    <button type="button" class="transpose-btn control-btn" aria-label="Transpose up one semitone" data-step="1">→</button>
    </div>

    <!-- accidentals toggle -->
    <div class="prefer-toggle control-box">
      <input type="radio" id="prefAuto" name="prefer" value="" checked>
      <label for="prefAuto" title="Automatic accidentals">A</label>

      <input type="radio" id="prefSharp" name="prefer" value="sharp">
      <label for="prefSharp" title="Prefer sharps">♯</label>

      <input type="radio" id="prefFlat" name="prefer" value="flat">
      <label for="prefFlat" title="Prefer flats">♭</label>
    </div>
    
    <div class = "control-box">
    <button type="button" class="transpose-reset control-btn" aria-label="Reset transposition to 0">Reset</button>
    </div>
  </div>

  <!-- layout toggle -->
  <div class = "control-box">
  <button type="button" class="control-btn" id="toggle-vertical">Switch to Single Column View</button>
  </div>

  <!-- scroll speed (info only) -->
  <div class = "control-box">
    <div id="auto-scroll-toggle" class="scroll-status">Scroll Speed</div>
  </div>
</div>

  {% if lines %}
    <h4 class="mt-4">Chords and Lyrics</h4>
    <div class="song-content">
      {% for line in lines %}
        {% if line.lyric == '' %}
          <div class="section-header">{{ line.chord|safe }}</div>
        {% else %}
          <div class="line-block">
            <div class="chord-line">{{ line.chord|safe }}</div>
            <div class="lyric-line">{{ line.lyric|safe }}</div>
          </div>
        {% endif %}
      {% endfor %}
    </div>
  {% else %}
    <p class="text-warning">No preview available — file could not be read.</p>
  {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/view_sheet.js') }}"></script>
{% endblock %}
